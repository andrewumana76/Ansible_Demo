- name: Hardening_Playbook
  hosts: myhosts
  tasks:
#---------------------------------------------------------------------------- 
#V-257779
#This is not a DoD system, only for example

    - name: RHEL9 must display DoD Notice
      copy:
        src: ../source_files/dod_banner_example.txt
        dest: /etc/issue
        owner: root
        group: root
        mode: 0644

#---------------------------------------------------------------------------- 
#V-257781

    - name: Graphical display manager must not be the default target on RHEL9
      ansible.builtin.command: 
        cmd: systemctl set-default multi-user.target

#---------------------------------------------------------------------------- 
#V-257782 - RHEL 9 must enable the hardware random number generator entropy gatherer service

    - name: Install rng-tools
      dnf:
        name:
          - rng-tools
        state: latest

    - name: Enable rng-tools
      shell: |
        systemctl enable --now rngd  
        systemctl start rngd
    
#---------------------------------------------------------------------------- 
#V-257783 - RHEL 9 systemd-journald service must be enabled
      
    - name: Enable systemd-journald
      shell: |
        systemctl enable --now systemd-journald
        systemctl start systemd-journald

#---------------------------------------------------------------------------- 
#V-257784 - THe systemd Ctrl-Alt-Delete brust key sequence in RHEL 9 must be disabled

    - name: Disabled Ctrl-Alt-Delete
      lineinfile:
        path: /etc/systemd/system.conf
        regexp: '^(.*)CtrlAltDelBurstAction(.*)$'
        line: 'CtrlAltDelBurstAction=none'
        backrefs: yes

#---------------------------------------------------------------------------- 
#V-257785 - The x86 Ctrl-ALt-Delete key sequence must be disabled on RHEL 9

    - name: Disabled ctrl-alt-delete.target
      ansible.builtin.command:
        cmd: systemctl disable --now ctrl-alt-del.target

    - name: Mask ctrl-alt-delete.target
      ansible.builtin.command:
        cmd: systemctl mask --now ctrl-alt-del.target

#---------------------------------------------------------------------------- 
#V-257786 - RHEL 9 debug-shell systemd service must be disabled

    - name: Disabled debug-shell.service
      ansible.builtin.command:
        cmd: systemctl disable --now debug-shell.service

    - name: Mask debug-shell.service
      ansible.builtin.command:
        cmd: systemctl mask --now debug-shell.service

#----------------------------------------------------------------------------
#V-257787 - RHEL 9 must require a boot loader superuser password
#This needs arguments to set and confirm password

    - name: Set a grub bootloader password. 
      ansible.builtin.expect:
        command: grub2-setpassword
        responses:
          (?i)Enter password: "random_password"
          (?i)Confirm password: "random_password" 

#----------------------------------------------------------------------------
